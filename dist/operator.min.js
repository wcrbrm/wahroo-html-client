/*! wahroo-html-client 13-05-2015 */
function getCharterSplitOptions(a,b){var c=0,d=2,e=4,f=1,g={};if(a>1&&a%2!==0)return console.log("Invalid Number of Fisherman"+a),g;if(4>a&&b==e&&(b=d),2>a&&b==d&&(b=f),b==c)for(var h=1;a>=h;h++)g[h]=h+"/"+a;else if(b==d){var i=a%b;if(0===i){var j=parseInt(a/b,10);g[j]=j+"/"+a,g[a]=a+"/"+a}else{var k=parseInt(a/b,10)+1;g[k]=k+"/"+a}}else if(b==e){var l=a%b;if(0===l){var m=parseInt(a/b,10);g[m]=m+"/"+a,g[2*m]=2*m+"/"+a,g[3*m]=3*m+"/"+a,g[a]=a+"/"+a}else{var n=parseInt(a/2,10),o=parseInt(a/4,10)+1,p=parseInt(3*a/4,10);g[o]=o+"/"+a,g[n]=n+"/"+a,g[p]=p+"/"+a,g[a]=a+"/"+a}}else{if(b!=f)return console.log("Invalid Splits number "+b),g;g[a]=a+"/"+a}return g}!function(){function a(a,b,c,d){var e=d.ROOT_HTML;a.setBaseUrl(d.ROOT_API),a.setRestangularFields({id:"id"}),b.when("/vessels/:id/dt/:dt/men/:men",{templateUrl:e+"/html/vessel/avail.html",controller:"VesselAvailabilityController"}).when("/vessels/:id",{templateUrl:e+"/html/vessel/detail.html",controller:"VesselDetailsController"}).when("/charters/:id/dt/:dt/men/:men",{templateUrl:e+"/html/charter/avail.html",controller:"CharterAvailabilityController"}).when("/charters/:id",{templateUrl:e+"/html/charter/detail.html",controller:"CharterDetailsController"}).when("/charters",{templateUrl:e+"/html/charter/index.html",controller:"CharterIndexController"}).when("/404",{templateUrl:e+"/html/404.html"}).when("/wahroo",{templateUrl:e+"/html/blank.html"}).otherwise({redirectTo:d.DEFAULT_LOCATION})}function b(a,b,c,d,e,f,g){a.resources=g,a.cartItems={};var h=localStorage.getItem("wahroo");h&&(a.cartItems=JSON.parse(h)),a.$on("$viewContentLoaded",function(){e.removeAll()}),a.$on("$routeChangeStart",function(){a.errors=[],a.back=function(){c.history.back()},a.isPhone=function(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}}),a.$on("$routeChangeSuccess",function(){b(function(){c.scrollTo(0,0)},1)}),f.setResponseInterceptor(function(b,c,d){return a.loading=!1,b}),f.setRequestInterceptor(function(b,c,d,e){return a.errors=[],a.loading=!0,b}),f.setErrorInterceptor(function(b){if(a.loading=!1,403==b.status||401==b.status)a.errors.push(b.data);else if(405==b.status)a.errors.push("Method not allowed");else if(422==b.status)for(var c in b.data)a.errors.push(b.data[c].join("\n"));else void 0!==b.data&&(null===b.data&&0===b.status?a.errors.push("Unable to connect to the server. Please refresh the page when internet connection will be restored"):401===b.status?a.errors=b.data.errors:(a.errors=b.data.errors,0===a.errors.length&&a.errors.push("Server response status: "+b.status)))})}angular.module("app",["ngRoute","ngAnimate","restangular","ui.date","ngMap"]),angular.module("app").config(a).run(b),a.$inject=["RestangularProvider","$routeProvider","$locationProvider","RESOURCES"],b.$inject=["$rootScope","$timeout","$window","$location","$templateCache","Restangular","RESOURCES"]}(),Date.prototype.toISOString||!function(){function a(a){return 10>a?"0"+a:a}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),angular.module("app").filter("trusted_html",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("app").filter("nice_price",function(){return function(a){return a?"$"+parseFloat(a).toFixed(2):""}}),angular.module("app").filter("nice_zero_price",function(){return function(a){return"$"+parseFloat(a).toFixed(2)}}),angular.module("app").filter("nice_features",function(){return function(a){if(void 0===a)return"";for(var b={},c=0;c<a.length;c++){var d=a[c].Field;"undefined"==typeof b[d]&&(b[d]=[]),b[d].push(a[c].Display_Value)}var e=[];for(var f in b)e.push(f+": <strong>"+b[f].join(", ")+"</strong>");return e.join("<br />")}}),angular.module("app").filter("nice_species",function(){return function(a){if(void 0===a)return"";for(var b={},c=0;c<a.length;c++){var d="Species";"undefined"==typeof b[d]&&(b[d]=[]),b[d].push(a[c].Display_Value)}var e=[];for(var f in b)e.push(f+": <strong>"+b[f].join(", ")+"</strong>");return e.join("<br />")}}),angular.module("app").filter("nice_time",function(){return function(a){if(a){var b=new Date;b.setUTCHours(a.substring(0,2)),b.setUTCMinutes(a.substring(3,5));var c=b.getUTCHours(),d=b.getUTCMinutes(),e=c>=12?"pm":"am";return c%=12,c=c?c:12,d=10>d?"0"+d:d,c+":"+d+" "+e}return""}}),angular.module("app").filter("nice_date",function(){return function(a){if(a){var b=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),c=new Date(a),d=b[c.getUTCMonth()]+" "+c.getUTCDate();return c.getUTCFullYear()!=(new Date).getUTCFullYear()&&(d+=", "+date.getUTCFullYear()),d}return""}}),angular.module("app").filter("nice_datetime",function(){return function(a){if(a){var b=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),c=new Date(a.replace(/\-/g,"/").replace("T"," ").replace(/\..+$/,"")),d=c.getHours(),e=c.getMinutes(),f=d>=12?"pm":"am";d%=12,d=d?d:12,e=10>e?"0"+e:e;var g="";return c.getUTCFullYear()!=(new Date).getUTCFullYear()&&(g=c.getUTCFullYear()+", "),g+b[c.getUTCMonth()]+" "+c.getUTCDate()+" "+d+":"+e+" "+f}return""}}),angular.module("app").filter("annual_date",function(){return function(a){if(a){var b=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),c=new Date(a.replace(/\-/g,"/").replace("T"," ").replace(/\..+$/,""));return b[c.getUTCMonth()]+" "+c.getUTCDate()}return""}}),angular.module("app").directive("bigImages",["RESOURCES",function(a){var b=a.ROOT_HTML;return{restrict:"A",scope:{images:"=source"},templateUrl:b+"/html/gallery/big.html",controller:["$scope","$window","$timeout",function(a,b,c){a.imageRoot="http://www.wahroo.com/imagelib/",a.currentSlide=0,a.lastSlide=a.images.length-1,a.fadeToSlide=function(b,c){a.currentSlide=b,setTimeout(function(){jQuery(window).trigger("resize")},50),setTimeout(function(){jQuery(window).trigger("resize")},500),setTimeout(function(){jQuery(window).trigger("resize")},1e3)},a.change=function(b){a.fadeToSlide(b,350)},a.prev=function(){var b=a.currentSlide-1;0>b&&(b=a.lastSlide),a.change(b)},a.next=function(){var b=a.currentSlide+1;b>a.lastSlide&&(b=0),a.change(b)},setTimeout(function(){jQuery(window).trigger("resize")},1e3)}]}}]),angular.module("app").directive("smallImages",["RESOURCES",function(a){var b=a.ROOT_HTML;return{restrict:"A",scope:{images:"=source"},templateUrl:b+"/html/gallery/small.html",controller:["$scope",function(a){a.imageRoot="http://www.wahroo.com/imagelib/",a.currentSlide=0,a.lastSlide=a.images.length-1,a.fadeToSlide=function(b,c){a.currentSlide=b,setTimeout(function(){jQuery(window).trigger("resize")},500),setTimeout(function(){jQuery(window).trigger("resize")},1e3)},a.change=function(b){a.fadeToSlide(b,350)},a.prev=function(){var b=a.currentSlide-1;0>b&&(b=a.lastSlide),a.change(b)},a.next=function(){var b=a.currentSlide+1;b>a.lastSlide&&(b=0),a.change(b)},setTimeout(function(){jQuery(window).trigger("resize")},1e3)}]}}]),angular.module("app").directive("autoHeight",["$window","$timeout",function(a,b){return{link:function(c,d,e){var f,g;return f=function(a){var b,c,d,e;for(b=0,d=0,e=a.length;e>d;d++)c=a[d],b+=c.offsetHeight;return b},g=function(a){var b,c,d,e,f;for(e=a.parent().children(),f=[],c=0,d=e.length;d>c;c++)b=e[c],b!==a[0]&&f.push(b);return f},angular.element(a).bind("resize",function(){var a;return a=e.additionalHeight||0,d.css("height",d.find("img:visible").height()+parseInt(a,10)+"px")}),b(function(){return angular.element(a).triggerHandler("resize")},200)}}}]),function(a){angular.module("app").directive("selectToBook",["$compile","$rootScope","ShoppingCart",function(b,c,d){return{restrict:"A",scope:{calendar:"=record"},link:function(e,f,g){var h="",i=e.calendar.ID;arrOptions=getCharterSplitOptions(e.calendar.Shares,e.calendar.Splits);var j=0,k=0;for(var l in arrOptions){var m="";c.cartItems[i]==l&&(m=" selected='selected' "),h+="<option value='"+l+"' "+m+">"+arrOptions[l]+"</option>",j++,k=l}e.canCancel=function(){return f.find("select").val()>0},e.bookSubmit=function(a){var b=f.attr("rel");d.item.add(b,a,e.calendar),f.find("select").val(a)},e.bookCancel=function(){var a=f.attr("rel");d.item.remove(a),f.find("select").val(0)};var n="<div "+(1==j?'style="display:none" ':"")+'>Book: <select class="booking"><option value="0"> - </option>'+h+"</select></div>",o="<button type='button' ng-if='!canCancel()' class='book' ng-click='bookSubmit("+k+")'>Book</button><button type='button' ng-if='canCancel()' class='book-cancel cancel' type='button' ng-click='bookCancel()'>Cancel</button>";f.attr("rel",i),f.html(1==j?n+o:n),f.find("select").on("change",function(a){var b=f.attr("rel"),c=f.find("select").val();parseInt(c,10)>0?d.item.add(b,c,e.calendar):d.item.remove(b)}),b(a(f).find("button"))(e),c.$watch(function(){f.find("select").val(void 0!==c.cartItems[i]?c.cartItems[i]:0)})}}}]),angular.module("app").directive("floatingShoppingCart",["RESOURCES","$rootScope","ShoppingCart",function(a,b,c){var d=a.ROOT_HTML;return{restrict:"A",templateUrl:d+"/html/cart/index.html",controller:["$scope","$rootScope",function(a,b,d){a.hasItemsInCart=function(){for(var a in b.cartItems)if(void 0!==b.cartItems[a])return!0;return!1},a.cart_collapsed=parseInt(localStorage.getItem("cart-collapse"),10),a.collapseCart=function(b){a.cart_collapsed=b,localStorage.setItem("cart-collapse",b)},a.destroy=function(a){c.item.remove(a)},a.checkout=function(){c.item.book()},a.getSubTotal=function(){var a=0;for(var c in b.cartItems)if(void 0!==b.cartItems[c]){var d=b.cartItems[c],e=JSON.parse(localStorage.getItem("calendar_"+c));a+=parseFloat(e.Price,10)*d/parseFloat(e.Shares,10)}return a},a.getTransactionFee=function(){var a=0,c=0;for(var d in b.cartItems)if(void 0!==b.cartItems[d]){var e=b.cartItems[d],f=JSON.parse(localStorage.getItem("calendar_"+d)),g=parseFloat(f.Price,10)*e/parseFloat(f.Shares,10),h=g*parseFloat(f.Deposit_Percent,10)/100,i=h*parseFloat(f.FeePct,10)/100+g*parseFloat(f.Embedded_Booking_Fee_Percent,10)/100;a+=i,c=parseFloat(f.FeeFlat,10)}return a+c},a.getDepositTotal=function(){var a=0;for(var c in b.cartItems)if(void 0!==b.cartItems[c]){var d=b.cartItems[c],e=JSON.parse(localStorage.getItem("calendar_"+c)),f=parseFloat(e.Price,10)*d/parseFloat(e.Shares,10);decDeposit=f*parseFloat(e.Deposit_Percent,10)/100,a+=decDeposit}return a}}]}}])}(jQuery),function(){function a(a,b,c,d){return me=this,this.item={reset:function(){localStorage.setItem("wahroo","")},add:function(b,c,d){return 0===parseInt(c,10)?this.item.remove(b):(localStorage.setItem("calendar_"+b,JSON.stringify(d)),a.cartItems[b]=c,a.$apply(),void localStorage.setItem("wahroo",JSON.stringify(a.cartItems)))},remove:function(b){a.cartItems[b]=void 0;var c=a.$$phase;"$apply"!=c&&"$digest"!=c&&a.$apply(),localStorage.setItem("wahroo",JSON.stringify(a.cartItems))},book:function(){var b=JSON.stringify(a.cartItems);localStorage.setItem("wahroo",""),$script(d.ROOT_API+"checkout?cart="+escape(b))}},this}angular.module("app").factory("ShoppingCart",a),a.$inject=["$rootScope","Restangular","$http","RESOURCES"]}(),function(){function a(a){return this.promise={to:{get:function(b){return a.all("charters").getList(b)},read:function(b){return a.one("charters",b).get()}}},this}function b(a){return this.promise={to:{read:function(b,c,d){return a.one("charters",b).one("dt",c).one("men",d).get()}}},this}angular.module("app").factory("CharterRequest",a).factory("CharterAvailRequest",b),a.$inject=["Restangular"],b.$inject=["Restangular"]}(),function(){function a(a){return this.promise={to:{get:function(b){return a.all("vessels").getList(b)},read:function(b){return a.one("vessels",b).get()}}},this}function b(a){return this.promise={to:{read:function(b,c,d){return a.one("vessels",b).one("dt",c).one("men",d).get()}}},this}angular.module("app").factory("VesselRequest",a).factory("VesselAvailRequest",b),a.$inject=["Restangular"],b.$inject=["Restangular"]}(),function(){function a(a,b){a.calendar=function(a){return JSON.parse(localStorage.getItem("calendar_"+a))},a.getCharterName=function(b){var c=a.calendar(b);return c.Headline},a.getVesselName=function(b){var c=a.calendar(b);return c.Vessel_Name},a.getStartTime=function(b){var c=a.calendar(b);return c.Start_Time},a.getStartDate=function(b){var c=a.calendar(b);return c.Start_DateTime},a.getDuration=function(b){var c=a.calendar(b);return c.Duration_Hours}}angular.module("app").controller("ShoppingCartItemController",a),a.$inject=["$scope","ShoppingCart"]}(),function(){function a(a,b){b.promise.to.get().then(function(b){a.charters=b.charter[0]})}function b(a,b,c,e){a.charter_id=b.id,a.availability={dt:"",men:1},a.dateOptions=d.dateOptions,a.dateMobileOptions=d.dateMobileOptions,a.loading=!0,c.promise.to.read(b.id).then(function(b){a.response=b,a.charter=b.charter[0],a.captain=b.captain[0],a.vessels=b.vessel,a.destination=b.destination[0],a.loading=!1}),a.select_reminder=function(){jQuery("html, body").animate({scrollTop:jQuery(".availability_form").offset().top-30},1e3),jQuery(".availability_form").addClass("highlighted"),jQuery(".availability_form .datepicker").focus(),setTimeout(function(){jQuery(".availability_form").removeClass("highlighted")},2200)},a.see_availability=function(){e.path("/charters/"+a.charter_id+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},a.navigate_vessel=function(a){e.path("/vessels/"+a)}}function c(a,b,c,e){a.charter_id=b.id,a.availability={dt:b.dt,men:b.men},a.dateOptions=d.dateOptions,a.dateMobileOptions=d.dateMobileOptions,a.loading=!0,a.nothing_is_available=function(){return!a.loading&&a.charter&&a.charter.calendar&&a.charter.calendar.length>0?!1:!0},a.reset_availability=function(){a.availability={dt:"",men:1},e.path("/charters/"+a.charter_id)},a.see_availability=function(){e.path("/charters/"+a.charter_id+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},a.navigate_charter=function(b){e.path("/charters/"+b+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},a.navigate_vessel=function(b){e.path("/vessels/"+b+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},c.promise.to.read(b.id,b.dt,b.men).then(function(b){a.charter=b.charter[0],a.captain=b.captain[0],a.vessels=b.vessel,a.destination=b.destination[0],a.loading=!1})}angular.module("app").controller("CharterIndexController",a).controller("CharterAvailabilityController",c).controller("CharterDetailsController",b);var d={first:function(a){for(var b in a)return a[b]},dateOptions:{numberOfMonths:2,minDate:new Date,changeYear:!0,changeMonth:!0},dateMobileOptions:{numberOfMonths:1,minDate:new Date,changeYear:!0,changeMonth:!0}};a.$inject=["$scope","Charter"],b.$inject=["$scope","$routeParams","CharterRequest","$location"],c.$inject=["$scope","$routeParams","CharterAvailRequest","$location"]}(),function(){function a(a,b){b.promise.to.get().then(function(b){a.vessels=b.vessel[0]})}function b(a,b,c,e){a.loading=!0,a.vessel_id=b.id,a.availability={dt:"",men:1},a.dateOptions=d.dateOptions,a.dateMobileOptions=d.dateMobileOptions,c.promise.to.read(b.id).then(function(b){a.response=b,a.vessel=b.vessel[0],a.captain=b.captain[0],a.charters=b.charter,a.destination=b.destination[0],a.loading=!1}),a.select_reminder=function(){jQuery("html, body").animate({scrollTop:jQuery(".availability_form").offset().top-30},1e3),jQuery(".availability_form").addClass("highlighted"),jQuery(".availability_form .datepicker").focus(),setTimeout(function(){jQuery(".availability_form").removeClass("highlighted")},2200)},a.see_availability=function(){e.path("/vessels/"+a.vessel_id+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},a.navigate_charter=function(a){e.path("/charters/"+a)}}function c(a,b,c,e){a.loading=!0,a.vessel_id=b.id,a.availability={dt:b.dt,men:b.men},a.dateOptions=d.dateOptions,a.dateMobileOptions=d.dateMobileOptions,a.nothing_is_available=function(){for(var b in a.charters)if(a.charters[b].calendar&&a.charters[b].calendar.length>0)return!1;return!0},a.reset_availability=function(){a.availability={dt:"",men:1},e.path("/vessels/"+a.vessel_id)},a.see_availability=function(){e.path("/vessels/"+a.vessel_id+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},a.navigate_charter=function(b){e.path("/charters/"+b+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},a.navigate_vessel=function(b){e.path("/vessels/"+b+"/dt/"+a.availability.dt+"/men/"+a.availability.men)},c.promise.to.read(b.id,b.dt,b.men).then(function(b){a.response=b,a.vessel=b.vessel[0],a.captain=b.captain[0],a.charters=b.charter,a.destination=b.destination[0],a.loading=!1})}angular.module("app").controller("VesselIndexController",a).controller("VesselAvailabilityController",c).controller("VesselDetailsController",b);var d={first:function(a){for(var b in a)return a[b]},dateOptions:{numberOfMonths:2,minDate:new Date,changeYear:!0,changeMonth:!0},dateMobileOptions:{numberOfMonths:1,minDate:new Date,changeYear:!0,changeMonth:!0}};a.$inject=["$scope","VesselRequest"],b.$inject=["$scope","$routeParams","VesselRequest","$location"],c.$inject=["$scope","$routeParams","VesselAvailRequest","$location"]}();